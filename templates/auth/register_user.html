<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de usuario</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename= 'css/auth/register_user.css') }}" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>

<body>
  <style>
    #carouselExampleCaptions {
      display: none;
    }
  </style>

  <main>
    <div class="custom-box">
      <div class="custom-inner-box">
        <div class="custom-forms-wrap">
          <form class="sign-in-form" method="POST">
            <div class="logo">
              <a href="{{url_for('home')}}"><img src="/static/img/banner/logo_uno.png"
                  alt="easyclass" width="100px" /></a>
              <h4><a href="{{url_for('home')}}">Gasolinera <span style="color: #1c3794;"> Uno montoya</span></a></h4>
            </div>

            <div class="heading">
              <h2>Iniciemos</h2>
              <h6>¿Ya tienes una cuenta?</h6>
              <a href="{{ url_for('login_user') }}" class="toggle" style="color: #1c3794;">Inicia Sesión</a>
            </div>

            <div class="actual-form registrarse-actual-form">
              <div class="input-wrap">
                <input type="text" class="input-field" id="nombres" name="nombres" autocomplete="off" required />
                <label>Nombre(s)</label>
              </div>

              <div class="input-wrap">
                <input type="text" class="input-field" id="apellidos" name="apeliidos" autocomplete="off" required />
                <label>Apellidos(s)</label>
              </div>

              <div class="input-wrap">
                <input type="text" class="input-field" id="cedula" name="cedula" autocomplete="off" required />
                <label>Cédula de identidad</label>
              </div>

              <div class="input-wrap">
                <input type="text" class="input-field" name="correo" autocomplete="off" id="email" required />
                <label>Correo electrónico</label>
                <div class="custom-tooltip" id="error-email-tooltip"></div>
              </div>

              <div class="input-wrap">
                <input type="tel" class="input-field" id="telefono" name="telefono" maxlength="8"
                  oninput="limitInputToEightDigits(event)" autocomplete="off" required />
                <label>Número de teléfono</label>
              </div>

              <div class="input-wrap">
                <input type="password" class="input-field" name="password" autocomplete="off" id="password" required />
                <label>Contraseña</label>
                <div class="custom-tooltip" id="password-error"></div>
              </div>


              <div class="input-wrap">
                <input type="password" class="input-field" autocomplete="off" id="confirm-password" disabled required />
                <label>Repetir contraseña</label>
                <div class="custom-tooltip" id="confirm-password-error"></div>
              </div>

              <button type="button" style="background: #1c3794;" class="sign-btn toggle" disabled>Registrarme</button>

              <script>

              </script>
            </div>

          </form>

          <form action="" autocomplete="off" class="sign-up-form" method="POST">
            <div class="logo">
              <a href="{{url_for('home')}}"><img src="/static/img/banner/logo_uno.png"
                  alt="easyclass" /></a>
              <h4><a href="{{url_for('home')}}">Gasolinera<span style="color: #1c3794;"> Uno montoya</span></a></h4>
            </div>

            <div class="heading registrarse-heading">
              <h2>Datos del vehiculo</h2>
              <a href="" data-toggle="modal" data-target="#modalExplicacion" style="color: #1c3794;">¿Por qué solicitamos
                estos datos?</a>
            </div>

            <div class="actual-form ubicacion-actual-form">
              <div class="input-wrap">
                <input type="text" class="form-control input-field" id="addressInput" required onclick="openModal()">
                <label>Agregar carro</label>

              </div>

              <input type="hidden" id="car_year" name="car_year">
              <input type="hidden" id="car_make" name="car_make">
              <input type="hidden" id="car_model" name="car_model">
              <input type="hidden" id="car_cc" name="car_cc">
              <input type="hidden" id="car_img" name="car_img">

              <div class="input-wrap">
                <input type="text" class="input-field" id="numeroPlaca" name="numeroPlaca" autocomplete="off" />
                <label>Número de placa (Opcional)</label>
              </div>

              <div class="input-wrap">
                <input type="text" class="input-field" id="numeroChasis" name="numeroChasis" autocomplete="off" />
                <label>Chasis (Opcional)</label>
              </div>

              <div class="input-wrap">
                <input type="text" class="input-field" id="numeroMotor" name="numeroMotor" autocomplete="off" />
                <label>Número de motor (opcinoal)</label>
              </div>

              <input type="submit" style="background: #1c3794;" value="Guardar ahora" id="submitButton" class="btn btn-danger">
              <input type="submit" value="Omitir" id="submitButton" class="btn btn-secondary">

              <p class="text mt-2">
                Al enviar estos formularios acepta nuestros términos y condiciones
                <a href="#">términos y condiciones</a>
              </p>
            </div>
          </form>
        </div>

        <div class="custom-carousel">
          <div class="images-wrapper">
            <img src="{{ url_for('static', filename= './img/registro.png')}} " class="image img-1 show"
              alt="" />
            <img src="{{ url_for('static', filename= './img/lubri_3.png')}} " class="image img-2" alt="" />
          </div>

          <div class="text-slider">
            <div class="text-wrap">
              <div class="text-group">
                <h2>Paso No. 1</h2>
                <h2>Paso No. 2</h2>
                <h2></h2>
              </div>
            </div>

            <div class="bullets">
              <span class="active" data-value="1"></span>
              <span data-value="2"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="myModal">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

          <div class="modal-header">
            <h4 class="modal-title">Detalles del <span>vehiculo</span></h4>
          </div>

          <div class="modal-body">
            <div class="input-wrap mt-1">

              <select id="year" name="year">
                <option value="">Año</option>
                <!-- Añadir opciones de año aquí -->
              </select>


              <select id="make" name="make">
                <!-- Las opciones se llenarán dinámicamente -->
                <option value="">Marca</option>
              </select>


              <select id="model" name="model">
                <!-- Las opciones se llenarán dinámicamente -->
                <option value="">Modelo</option>
              </select>


              <select id="Engine displacement" name="Engine displacement">
                <!-- Las opciones se llenarán dinámicamente -->
                <option value="">CC</option>

              </select>
            </div>



            <div id="carouselExampleCaptions" class="carousel slide carousel-fade" data-interval="false">
              <ol class="carousel-indicators">
                <li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
                <li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
                <li data-target="#carouselExampleCaptions" data-slide-to="2"></li>
              </ol>
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="..." class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                  <img src="..." class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                  <img src="..." class="d-block w-100" alt="...">
                </div>
              </div>
              <a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>

            <!-- Número de imagen actual -->
            <p class="mt-3"><strong>Imagen del vehiculo</strong> <span id="selectedLocationLabel"></span></p>

          </div>

          <div class="modal-footer">
            <button type="button" class="btn sign-btn" id="search-button">Buscar imagen del vehiculo</button>
            <button type="button" class="btn sign-btn" id="save-car" onclick="guardarDatos()">Guardar</button>
          </div>



        </div>
      </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="modalExplicacion" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel" style="color: #1c3794;">¿Por qué solicitamos estos datos?</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Para mejorar nuestro servicio, por favor comparta algunos datos de su vehículo. Son opcionales, pero nos
              permitirán conocer mejor su vehículo y darle recomendaciones personalizadas. También los usaremos en un
              chatbot que le dará consejos útiles para cuidarlo.</p>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal HTML -->
    <div class="modal" id="otrosModal">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="otrosModalLabel">Introduzca el nombre de la dirección</h5>
          </div>
          <div class="modal-body">

            <div class="textarea-wrap mt-3">
              <textarea name="text" id="otros-input" rows="1" oninput="autoGrowTextArea(this)" maxlength="5"
                required></textarea>
              <label for="text">Nombre</label>
            </div>
            <div class="label-area">
              <label class="custom-label" id="char-count">0/5</label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="sign-btn" data-dismiss="modal" id="guardarBtn">Guardar</button>
          </div>
        </div>
      </div>
    </div>
    </div>

  </main>

  <script>
    $(document).ready(function () {
      $("#submitButton").click(function (event) {
        event.preventDefault(); // Prevenir el envío del formulario estándar

        // Obtener datos del primer formulario
        var nombres = $("#nombres").val();
        var apellidos = $("#apellidos").val();
        var cedula = $("#cedula").val();
        var email = $("#email").val();
        var telefono = $("#telefono").val();
        var password = $("#password").val();



        // ... otros campos del primer formulario

        // Obtener datos del segundo formulario
        var carYear = $("#car_year").val();
        var carMake = $("#car_make").val();
        var carModel = $("#car_model").val();
        var carCC = $("#car_cc").val();
        var carImg = $("#car_img").val();
        var numeroPlaca = $("#numeroPlaca").val();
        var numeroChasis = $("#numeroChasis").val();
        var numeroMotor = $("#numeroMotor").val();
        // ... otros campos del segundo formulario

        // Combinar datos de ambos formularios
        var combinedData = {
          "nombres": nombres,
          "apellidos": apellidos,
          "cedula": cedula,
          "email": email,
          "telefono": telefono,
          "password": password,
          // ... otros campos del primer formulario
          "car_year": carYear,
          "car_make": carMake,
          "car_model": carModel,
          "car_cc": carCC,
          "car_img": carImg,
          "numeroPlaca": numeroPlaca,
          "numeroChasis": numeroChasis,
          "numeroMotor": numeroMotor
          // ... otros campos del segundo formulario
        };

        // Enviar datos al servidor usando AJAX
        $.ajax({
          type: "POST",
          url: "/register_user", // Reemplaza "/tu_ruta" con la URL de tu endpoint Flask
          data: combinedData,
          success: function (response) {
            console.log(response); // Manejar la respuesta del servidor si es necesario
            window.location.href = "/";
          },
          error: function (error) {
            console.error("Error al enviar datos: " + error);
          }
        });
      });
    });
  </script>


  <!-- Javascript file -->
  <script src="{{ url_for('static', filename='/js/register_user.js') }}"></script>
  <script>


    function openModal() {
      $("#myModal").modal("show");
    }

    function closeModal() {
      $("#myModal").modal("hide");
    }

  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const radio3 = document.getElementById("radio3");
      const otrosModal = new bootstrap.Modal(document.getElementById("otrosModal"));
      const guardarBtn = document.getElementById("guardarBtn");
      const otrosInputLabel = document.querySelector(".radio-button__label[for='radio3']");

      radio3.addEventListener("click", function () {
        $("#otrosModal").modal("show");
      });


      guardarBtn.addEventListener("click", function () {
        const otrosInput = document.getElementById("otros-input").value;
        otrosInputLabel.textContent = otrosInput;
        otrosModal.hide();
      });
    });
  </script>

  <script>

    function loadYears() {
      fetch('/get_years')
        .then(response => response.json())
        .then(data => {
          let yearSelect = document.getElementById('year');
          yearSelect.innerHTML = data.map(year => `<option value="${year}">${year}</option>`).join('');
        });
    }

    // Llama a la función loadYears cuando se carga la página
    window.onload = loadYears;

    document.getElementById('year').addEventListener('change', function () {
      fetch('/get_makes?year=' + this.value)
        .then(response => response.json())
        .then(data => {
          let makeSelect = document.getElementById('make');
          makeSelect.innerHTML = data.map(make => `<option value="${make}">${make}</option>`).join('');
        });
    });

    document.getElementById('make').addEventListener('change', function () {
      const year = document.getElementById('year').value;
      fetch(`/get_models?year=${year}&make=${this.value}`)
        .then(response => response.json())
        .then(data => {
          let modelSelect = document.getElementById('model');
          modelSelect.innerHTML = data.map(model => `<option value="${model}">${model}</option>`).join('');
        });
    });

    document.getElementById('model').addEventListener('change', function () {
      const year = document.getElementById('year').value;
      const make = document.getElementById('make').value;
      fetch(`/get_engine_displacements?year=${year}&make=${make}&model=${this.value}`)
        .then(response => response.json())
        .then(data => {
          let engineDisplacementSelect = document.getElementById('Engine displacement');
          engineDisplacementSelect.innerHTML = data.map(displ => `<option value="${displ}">${displ} L</option>`).join('');
        });
    });

    document.getElementById('search-button').addEventListener('click', function () {
      const year = document.getElementById('year').value;
      const make = document.getElementById('make').value;
      const model = document.getElementById('model').value;

      fetch(`/search_images?year=${year}&make=${make}&model=${model}`)
        .then(response => response.json())
        .then(data => {
          const carouselInner = document.querySelector('#carouselExampleCaptions .carousel-inner');
          carouselInner.innerHTML = '';

          data.forEach((url, index) => {
            const carouselItem = document.createElement('div');
            carouselItem.classList.add('carousel-item');
            if (index === 0) {
              carouselItem.classList.add('active');
            }

            const img = document.createElement('img');
            img.classList.add('d-block', 'w-100');
            img.src = url;
            img.alt = 'Car Image';



            carouselItem.appendChild(img);
            carouselInner.appendChild(carouselItem);

            // Actualizar el número de imagen actual
            const imageNumber = index + 1;
            const selectedLocationLabel = document.getElementById('selectedLocationLabel');
            selectedLocationLabel.textContent = `Imagen ${imageNumber} de ${data.length}`;
          });
          // Mostrar el carrusel después de agregar imágenes
          document.getElementById('carouselExampleCaptions').style.display = 'block';

          // Activar el evento de Bootstrap para el carrusel
          $('#carouselExampleCaptions').carousel();

          $('#carouselExampleCaptions').on('slid.bs.carousel', function (event) {
            const activeIndex = event.to;
            const totalImages = data.length;
            const imageNumber = activeIndex + 1;
            const selectedLocationLabel = document.getElementById('selectedLocationLabel');
            selectedLocationLabel.textContent = `Imagen ${imageNumber} de ${totalImages}`;
          });
        });
    });
  </script>

  <script>
    function guardarDatos() {
      // Obtén los valores seleccionados de los campos de selección
      var year = document.getElementById("year").value;
      var make = document.getElementById("make").value;
      var model = document.getElementById("model").value;
      var engineDisplacement = document.getElementById("Engine displacement").value;

      // Obtén la URL de la imagen actual del carousel
      var carouselImages = document.querySelectorAll("#carouselExampleCaptions .carousel-item img");
      var carImageUrl = carouselImages[0].src; // Suponiendo que la primera imagen sea la seleccionada

      // Almacena los valores en el campo de texto y en el campo oculto
      var addressInput = document.getElementById("addressInput");
      var carImgInput = document.getElementById("car_img");

      addressInput.value = `Año: ${year}, Marca: ${make}, Modelo: ${model}, CC: ${engineDisplacement}`;
      car_year.value = year;
      car_make.value = make;
      car_model.value = model;
      car_cc.value = engineDisplacement;
      carImgInput.value = carImageUrl;

      // Cierra el modal
      $("#myModal").modal("hide");
    }
  </script>

</body>

</html>